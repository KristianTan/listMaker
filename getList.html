<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>List Maker - List Viewer</title>
    <link rel="stylesheet" href="static/style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:200,400,700&display=swap" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">
        id = null

        function getList(codeValue) {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);

            $.ajax({
                data: {
                    // Change this to be url param from index.html
                    code: urlParams.get('code')
                },
                type: 'GET',
                url: 'http://127.0.0.1:5000/getList'
            }).done(function (data) {

                $('#listViewerTitle').text(data.title).show();
                if (data.message === 'No list found for that code') {
                    window.alert('No list found with code: ' + data.code)
                    window.open('index.html', '__self');
                }
                id = data.id;
                $('#listId').text('(list code: ' + data.code + ')').show();

                html_list = "<ol id='listViewerEntries'>"
                data.entries.forEach(function (item) {
                    html_list += "<li>" + item + "</li>";

                })
                html_list += "</ul>"

                document.getElementById("entryList").innerHTML = html_list;
            });
        }


        $(document).ready(function () {
            $('#newItemForm').on('submit', function (event) {
                $.ajax({
                    data: {
                        'listId': id,
                        'text': $('#newItemText').val()
                    },
                    type: 'POST',
                    url: 'http://127.0.0.1:5000/newEntry'
                }).done(function () {
                    window.location.reload();
                });
                event.preventDefault();
            });
        });

    </script>
</head>

<body onload="getList()">
<div class="header">
    <h1 class="title"><a href="index.html"> List Maker</a></h1>
    <h2 class="subTitle">Create lists to share with your friends!</h2>
</div>

<h2 id="listViewerTitle"></h2>
<h3 id="listId"></h3id></h3>

<div id="entryList"></div>
<form id="newItemForm">
    <input id="newItemText" type="text">
</form>

</body>
</html>